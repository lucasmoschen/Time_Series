---
title: "Vendas de Carros Noruega"
author: "Lucas Moschen e Matheus Paes"
date: "8/26/2020"
output: pdf_document
---

**TO DO** 

1. Escolher uma marca dentre (Toyota, Volksvagen, Ford e Volvo) - Cada grupo deve trabalhar com uma marca diferente.

2. Extrair a base de vendas mensais relativa a marca escolhida e plote as vendas por mês.

3. Utilize janelas de 2 anos para prever 1 mês a frente [(1)]

4. Utilize um modelo de regressão para prever vendas (e.g., tendência polinomial e dummies sazonais)

5. Utilize um modelo de decomposição (e.g. loess)

6. Utilize um modelo de alisamento exponencial (e.g. exponential smoothing, Holt ou Holt-Winters)

7. Compare as previsões usando o MAPE de cada um dos modelos [(2)]

8. Apresente os plots das previsões 1 passo à frente e a estatística MAPE de cada um dos modelos testados. [(3)]

Primeiro, baixamos os dados e separamos a marca a ser estudada. Também vemos a série temporal. 

```{r, warning=FALSE, message = FALSE}
#Importando bibliotecas
library(dplyr)
library(zoo)
library(forecast)

setwd("~/OneDrive/FGV/Eletivas ou Complementares/Séries Temporais/trabalho1")

cars_df  = read.csv('norway_new_car_sales_by_make.csv')
make = 'Toyota'

make_df = subset(cars_df, Make == make)
make_df$Date <- zoo::as.yearmon(paste(make_df$Year, make_df$Month), "%Y %m")

qtd <- zooreg(make_df$Quantity, frequency = 12, start = c(2007,1))

estim <- function(v_window) {
  es1 <- HoltWinters(v_window, beta=F, gamma=F)
  as.numeric(forecast(es1,1)$mean)
}

yhat <- rollapply(qtd,24,estim)
yhat <- zooreg(yhat, frequency = 12, start = c(2009,1), end = c(2017,2))
yhat

plot(make_df$Date, make_df$Quantity, xlab = 'Ano', ylab = 'Vendas', 
     main = 'Vendas de carros da marca Toyota por mês')
```

Podemos fazer uma decomposição, considerando a janela de 12 meses para verificar tendência e sazonalidade. 

```{r}
decomposition = stl(zooreg(make_df$Quantity, start = c(2007,1), frequency = 12), s.window = 12)

plot(decomposition)
```

